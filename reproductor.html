<!DOCTYPE html>
<html>
<head>
    <title>Reproductor IPTV</title>
    <script src="//cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        #loading { color: white; text-align: center; padding-top: 40vh; font-family: sans-serif; position: absolute; width: 100%; }
    </style>
</head>
<body>
    <div id="player"></div>
    <div id="loading">Cargando...</div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const channelId = urlParams.get('id'); 

        const playerElement = document.getElementById('player');
        const loadingElement = document.getElementById('loading');
        
        if (channelId) {
            // ==========================================================
            //       LA LÍNEA MÁS IMPORTANTE DE TODO EL PROYECTO
            // Debe ser la URL completa de tu OTRO proyecto (el servidor)
            // ==========================================================
            const apiUrl = `https://eventoshd.vercel.app/canal?id=${channelId}`;

            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadingElement.style.display = 'none';
                        
                        new Clappr.Player({
                            source: data.url,
                            parentId: "#player",
                            width: "100%",
                            height: "100%",
                            autoPlay: true,
                            mediacontrol: { seekbar: "#D4ED31", buttons: "#FFFFFF" }
                        });
                    } else {
                        loadingElement.innerText = `Error: ${data.error}`;
                    }
                })
                .catch(error => {
                    loadingElement.innerText = `Error de conexión con el servidor API.`;
                });
        } else {
            loadingElement.innerText = 'Por favor, especifica un ID de canal en la URL (ej: ?id=741816)';
        }
    </script>
</body>
</html>
